In statistical mechanics, the virial theorem provides a general equation that relates the average over time of the total kinetic energy of a stable system of discrete particles, bound by a conservative force (forces characterized exclusively by their work), with that of the total potential energy of the system. Mathematically, the theorem states

where T is the total kinetic energy of the N particles, Fk represents the force on the kth particle, which is located at position rk, and angle brackets represent the average over time of the enclosed quantity. The word virial for the right-hand side of the equation derives from vis, the Latin word for "force" or "energy", and was given its technical definition by Rudolf Clausius in 1870.The significance of the virial theorem is that it allows the average total kinetic energy to be calculated even for very complicated systems that defy an exact solution, such as those considered in statistical mechanics; this average total kinetic energy is related to the temperature of the system by the equipartition theorem. However, the virial theorem does not depend on the notion of temperature and holds even for systems that are not in thermal equilibrium. The virial theorem has been generalized in various ways, most notably to a tensor form.
If the force between any two particles of the system results from a potential energy V(r) = αrn that is proportional to some power n of the interparticle distance r, the virial theorem takes the simple form

Thus, twice the average total kinetic energy ⟨T⟩ equals n times the average total potential energy ⟨VTOT⟩. Whereas V(r) represents the potential energy between two particles of distance r, VTOT represents the total potential energy of the system, i.e., the sum of the potential energy V(r) over all pairs of particles in the system. A common example of such a system is a star held together by its own gravity, where n equals −1.

History
In 1870, Rudolf Clausius delivered the lecture "On a Mechanical Theorem Applicable to Heat" to the Association for Natural and Medical Sciences of the Lower Rhine, following a 20-year study of thermodynamics. The lecture stated that the mean vis viva of the system is equal to its virial, or that the average kinetic energy is equal to 1/2 the average potential energy. The virial theorem can be obtained directly from Lagrange's identity as applied in classical gravitational dynamics, the original form of which was included in Lagrange's "Essay on the Problem of Three Bodies" published in 1772. Karl Jacobi's generalization of the identity to N bodies and to the present form of Laplace's identity closely resembles the classical virial theorem. However, the interpretations leading to the development of the equations were very different, since at the time of development, statistical dynamics had not yet unified the separate studies of thermodynamics and classical dynamics. The theorem was later utilized, popularized, generalized and further developed by James Clerk Maxwell, Lord Rayleigh, Henri Poincaré, Subrahmanyan Chandrasekhar, Enrico Fermi, Paul Ledoux, Richard Bader and Eugene Parker. Fritz Zwicky was the first to use the virial theorem to deduce the existence of unseen matter, which is now called dark matter. Richard Bader showed the charge distribution of a total system can be partitioned into its kinetic and potential energies that obey the virial theorem. As another example of its many applications, the virial theorem has been used to derive the Chandrasekhar limit for the stability of white dwarf stars.

Illustrative special case
Consider N = 2 particles with equal mass m, acted upon by mutually attractive forces. Suppose the particles are at diametrically opposite points of a circular orbit with radius r. The velocities are v1(t) and v2(t) = −v1(t), which are normal to forces F1(t) and F2(t) = −F1(t). The respective magnitudes are fixed at v and F. The average kinetic energy of the system in an interval of time from t1 to t2 is 

Taking center of mass as the origin, the particles have positions r1(t) and r2(t) = −r1(t) with fixed magnitude r. The attractive forces act in opposite directions as positions, so F1(t) ⋅ r1(t) = F2(t) ⋅ r2(t) = −Fr. Applying the centripetal force formula F = mv2/r results in:

as required. Note: If the origin is displaced then we'd obtain the same result. This is because the dot product of the displacement with equal and opposite forces F1(t), F2(t) results in net cancellation.

Statement and derivation
Although the virial theorem depends on averaging the total kinetic and potential energies, the presentation here postpones the averaging to the last step.
For a collection of N point particles, the scalar moment of inertia I about the origin is defined by the equation

where mk and rk represent the mass and position of the kth particle. rk = |rk| is the position vector magnitude. The scalar G is defined by the equation

where pk is the momentum vector of the kth particle. Assuming that the masses are constant, G is one-half the time derivative of this moment of inertia

In turn, the time derivative of G can be written

where mk is the mass of the kth particle, Fk = dpk/dt is the net force on that particle, and T is the total kinetic energy of the system according to the vk = drk/dt velocity of each particle

Connection with the potential energy between particles
The total force Fk on particle k is the sum of all the forces from the other particles j in the system

where Fjk is the force applied by particle j on particle k. Hence, the virial can be written

Since no particle acts on itself (i.e., Fjj = 0 for 1 ≤ j ≤ N), we split the sum in terms below and above this diagonal and we add them together in pairs:

where we have assumed that Newton's third law of motion holds, i.e., Fjk = −Fkj (equal and opposite reaction).
It often happens that the forces can be derived from a potential energy Vjk that is a function only of the distance rjk between the point particles j and k. Since the force is the negative gradient of the potential energy, we have in this case

which is equal and opposite to Fkj = −∇rjVkj = −∇rjVjk, the force applied by particle k on particle j, as may be confirmed by explicit calculation. Hence,

Thus, we have

Special case of power-law forces
In a common special case, the potential energy V between two particles is proportional to a power n of their distance rij

where the coefficient α and the exponent n are constants. In such cases, the virial is given by the equation

where VTOT is the total potential energy of the system

Thus, we have

For gravitating systems the exponent n equals −1, giving Lagrange's identity

which was derived by Joseph-Louis Lagrange and extended by Carl Jacobi.

Time averaging
The average of this derivative over a duration of time, τ, is defined as

from which we obtain the exact equation

The virial theorem states that if ⟨dG/dt⟩τ = 0, then

There are many reasons why the average of the time derivative might vanish, ⟨dG/dt⟩τ = 0. One often-cited reason applies to stably-bound systems, that is to say systems that hang together forever and whose parameters are finite. In that case, velocities and coordinates of the particles of the system have upper and lower limits so that Gbound, is bounded between two extremes, Gmin and Gmax, and the average goes to zero in the limit of infinite τ:

Even if the average of the time derivative of G is only approximately zero, the virial theorem holds to the same degree of approximation.
For power-law forces with an exponent n, the general equation holds:

For gravitational attraction, n equals −1 and the average kinetic energy equals half of the average negative potential energy

This general result is useful for complex gravitating systems such as solar systems or galaxies.
A simple application of the virial theorem concerns galaxy clusters. If a region of space is unusually full of galaxies, it is safe to assume that they have been together for a long time, and the virial theorem can be applied. Doppler effect measurements give lower bounds for their relative velocities, and the virial theorem gives a lower bound for the total mass of the cluster, including any dark matter.
If the ergodic hypothesis holds for the system under consideration, the averaging need not be taken over time; an ensemble average can also be taken, with equivalent results.

In quantum mechanics
Although originally derived for classical mechanics, the virial theorem also holds for quantum mechanics, as first shown by Fock using the Ehrenfest theorem.
Evaluate the commutator of the Hamiltonian

with the position operator Xn and the momentum operator

of particle n,

Summing over all particles, one finds for

the commutator amounts to

where 
  
    
      
        T
        =
        
          ∑
          
            n
          
        
        
          
            
              P
              
                n
              
              
                2
              
            
            
              2
              m
            
          
        
      
    
    {\textstyle T=\sum _{n}{\frac {P_{n}^{2}}{2m}}}
   is the kinetic energy. The left-hand side of this equation is just dQ/dt, according to the Heisenberg equation of motion. The expectation value ⟨dQ/dt⟩ of this time derivative vanishes in a stationary state, leading to the quantum virial theorem,

Pokhozhaev's identity
In the field of quantum mechanics, there exists another form of the virial theorem, applicable to localized solutions to the stationary nonlinear Schrödinger equation or Klein–Gordon equation, is Pokhozhaev's identity, also known as Derrick's theorem.
Let 
  
    
      
        g
        (
        s
        )
      
    
    {\displaystyle g(s)}
   be continuous and real-valued, with 
  
    
      
        g
        (
        0
        )
        =
        0
      
    
    {\displaystyle g(0)=0}
  .
Denote 
  
    
      
        G
        (
        s
        )
        =
        
          ∫
          
            0
          
          
            s
          
        
        g
        (
        t
        )
        
        d
        t
      
    
    {\textstyle G(s)=\int _{0}^{s}g(t)\,dt}
  .
Let

be a solution to the equation
 in the sense of distributions.
Then 
  
    
      
        u
      
    
    {\displaystyle u}
   satisfies the relation

In special relativity
For a single particle in special relativity, it is not the case that T = 1/2p · v. Instead, it is true that T = (γ − 1) mc2, where γ is the Lorentz factor

and β = v/c. We have,

The last expression can be simplified to
.
Thus, under the conditions described in earlier sections (including Newton's third law of motion, Fjk = −Fkj, despite relativity), the time average for N particles with a power law potential is

In particular, the ratio of kinetic energy to potential energy is no longer fixed, but necessarily falls into an interval:

where the more relativistic systems exhibit the larger ratios.

Examples
The virial theorem has a particularly simple form for periodic motion. It can be used to perform perturbative calculation for nonlinear oscillators.It can also be used to study motion in a central potential. If the central potential is of the form 
  
    
      
        U
        ∝
        
          r
          
            n
          
        
      
    
    {\displaystyle U\propto r^{n}}
  , the virial theorem simplifies to 
  
    
      
        ⟨
        T
        ⟩
        =
        
          
            
              n
              +
              1
            
            2
          
        
        ⟨
        U
        ⟩
      
    
    {\displaystyle \langle T\rangle ={\frac {n+1}{2}}\langle U\rangle }
  . In particular, for gravitational or electrostatic (Coulomb) attraction, 
  
    
      
        ⟨
        T
        ⟩
        =
        −
        
          
            1
            2
          
        
        ⟨
        U
        ⟩
      
    
    {\displaystyle \langle T\rangle =-{\frac {1}{2}}\langle U\rangle }
  .

Ideal gas law
Consider a container filled with an ideal gas consisting of point masses. The force applied to the point masses is the negative of the forces applied to the wall of the container, which is of the form 
  
    
      
        d
        
          F
        
        =
        −
        
          
            
              n
              ^
            
          
        
        P
        d
        A
      
    
    {\displaystyle d\mathbf {F} =-\mathbf {\hat {n}} PdA}
  , where 
  
    
      
        
          
            
              n
              ^
            
          
        
      
    
    {\displaystyle \mathbf {\hat {n}} }
   is the unit normal vector pointing outwards. Then the virial theorem statesBy the divergence theorem, 
  
    
      
        ∫
        
          
            
              n
              ^
            
          
        
        ⋅
        
          r
        
        d
        A
        =
        ∫
        ∇
        ⋅
        
          r
        
        d
        V
        =
        3
        ∫
        d
        V
        =
        3
        V
      
    
    {\textstyle \int \mathbf {\hat {n}} \cdot \mathbf {r} dA=\int \nabla \cdot \mathbf {r} dV=3\int dV=3V}
  . And since the average total kinetic energy 
  
    
      
        ⟨
        T
        ⟩
        =
        N
        ⟨
        
          
            1
            2
          
        
        m
        
          v
          
            2
          
        
        ⟩
        =
        N
        ⋅
        
          
            3
            2
          
        
        k
        T
      
    
    {\textstyle \langle T\rangle =N\langle {\frac {1}{2}}mv^{2}\rangle =N\cdot {\frac {3}{2}}kT}
  , we have 
  
    
      
        P
        V
        =
        N
        k
        T
      
    
    {\displaystyle PV=NkT}
  .

Dark matter
In 1933, Fritz Zwicky applied the virial theorem to estimate the mass of Coma Cluster, and discovered a discrepancy of mass of about 450, which he explained as due to "dark matter". He refined the analysis in 1937, finding a discrepancy of about 500.

Theoretical analysis
He approximated the Coma cluster as a spherical "gas" of 
  
    
      
        N
      
    
    {\displaystyle N}
   stars of roughly equal mass 
  
    
      
        m
      
    
    {\displaystyle m}
  , which gives 
  
    
      
        ⟨
        T
        ⟩
        =
        
          
            1
            2
          
        
        N
        m
        ⟨
        
          v
          
            2
          
        
        ⟩
      
    
    {\textstyle \langle T\rangle ={\frac {1}{2}}Nm\langle v^{2}\rangle }
  . The total gravitational potential energy of the cluster is 
  
    
      
        U
        =
        −
        
          ∑
          
            i
            <
            j
          
        
        
          
            
              G
              
                m
                
                  2
                
              
            
            
              r
              
                i
                ,
                j
              
            
          
        
      
    
    {\displaystyle U=-\sum _{i<j}{\frac {Gm^{2}}{r_{i,j}}}}
  , giving 
  
    
      
        ⟨
        U
        ⟩
        =
        −
        G
        
          m
          
            2
          
        
        
          ∑
          
            i
            <
            j
          
        
        ⟨
        
          1
        
        
          /
        
        
          
            r
            
              i
              ,
              j
            
          
        
        ⟩
      
    
    {\textstyle \langle U\rangle =-Gm^{2}\sum _{i<j}\langle {1}/{r_{i,j}}\rangle }
  . Assuming the motion of the stars are all the same over a long enough time (ergodicity), 
  
    
      
        ⟨
        U
        ⟩
        =
        −
        
          
            1
            2
          
        
        
          N
          
            2
          
        
        G
        
          m
          
            2
          
        
        ⟨
        
          1
        
        
          /
        
        
          r
        
        ⟩
      
    
    {\textstyle \langle U\rangle =-{\frac {1}{2}}N^{2}Gm^{2}\langle {1}/{r}\rangle }
  .
Zwicky estimated 
  
    
      
        ⟨
        U
        ⟩
      
    
    {\displaystyle \langle U\rangle }
   as the gravitational potential of a uniform ball of constant density, giving 
  
    
      
        ⟨
        U
        ⟩
        =
        −
        
          
            3
            5
          
        
        
          
            
              G
              
                N
                
                  2
                
              
              
                m
                
                  2
                
              
            
            R
          
        
      
    
    {\textstyle \langle U\rangle =-{\frac {3}{5}}{\frac {GN^{2}m^{2}}{R}}}
  .
So by the virial theorem, the total mass of the cluster is

Data
Zwicky
  
    
      
        
          
          
            1933
          
        
      
    
    {\displaystyle _{1933}}
   estimated that there are 
  
    
      
        N
        =
        800
      
    
    {\displaystyle N=800}
   galaxies in the cluster, each having observed stellar mass 
  
    
      
        m
        =
        
          10
          
            9
          
        
        
          M
          
            ⊙
          
        
      
    
    {\displaystyle m=10^{9}M_{\odot }}
   (suggested by Hubble), and the cluster has radius 
  
    
      
        R
        =
        
          10
          
            6
          
        
        
          ly
        
      
    
    {\displaystyle R=10^{6}{\text{ly}}}
  . He also measured the radial velocities of the galaxies by doppler shifts in galactic spectra to be 
  
    
      
        ⟨
        
          v
          
            r
          
          
            2
          
        
        ⟩
        =
        (
        1000
        
          km/s
        
        
          )
          
            2
          
        
      
    
    {\displaystyle \langle v_{r}^{2}\rangle =(1000{\text{km/s}})^{2}}
  . Assuming equipartition of kinetic energy, 
  
    
      
        ⟨
        
          v
          
            2
          
        
        ⟩
        =
        3
        ⟨
        
          v
          
            r
          
          
            2
          
        
        ⟩
      
    
    {\displaystyle \langle v^{2}\rangle =3\langle v_{r}^{2}\rangle }
  .
By the virial theorem, the total mass of the cluster should be 
  
    
      
        
          
            
              5
              R
              ⟨
              
                v
                
                  r
                
                
                  2
                
              
              ⟩
            
            G
          
        
        ≈
        3.6
        ×
        
          10
          
            14
          
        
        
          M
          
            ⊙
          
        
      
    
    {\displaystyle {\frac {5R\langle v_{r}^{2}\rangle }{G}}\approx 3.6\times 10^{14}M_{\odot }}
  . However, the observed mass is 
  
    
      
        N
        m
        =
        8
        ×
        
          10
          
            11
          
        
        
          M
          
            ⊙
          
        
      
    
    {\displaystyle Nm=8\times 10^{11}M_{\odot }}
  , meaning the total mass is 450 times that of observed mass.

Generalizations
Lord Rayleigh published a generalization of the virial theorem in 1900 and was partially reprinted in 1903. Henri Poincaré proved and applied a form of the virial theorem in 1911 to the problem of formation of the Solar System from a proto-stellar cloud (then known as cosmogony). A variational form of the virial theorem was developed in 1945 by Ledoux. A tensor form of the virial theorem was developed by Parker, Chandrasekhar and Fermi. The following generalization of the virial theorem has been established by Pollard in 1964 for the case of the inverse square law:
A boundary term otherwise must be added.

Inclusion of electromagnetic fields
The virial theorem can be extended to include electric and magnetic fields. The result is
where I is the moment of inertia, G is the momentum density of the electromagnetic field, T is the kinetic energy of the "fluid", U is the random "thermal" energy of the particles, WE and WM are the electric and magnetic energy content of the volume considered. Finally, pik is the fluid-pressure tensor expressed in the local moving coordinate system

and Tik is the electromagnetic stress tensor,

A plasmoid is a finite configuration of magnetic fields and plasma. With the virial theorem it is easy to see that any such configuration will expand if not contained by external forces. In a finite configuration without pressure-bearing walls or magnetic coils, the surface integral will vanish. Since all the other terms on the right hand side are positive, the acceleration of the moment of inertia will also be positive. It is also easy to estimate the expansion time τ. If a total mass M is confined within a radius R, then the moment of inertia is roughly MR2, and the left hand side of the virial theorem is MR2/τ2. The terms on the right hand side add up to about pR3, where p is the larger of the plasma pressure or the magnetic pressure. Equating these two terms and solving for τ, we find

where cs is the speed of the ion acoustic wave (or the Alfvén wave, if the magnetic pressure is higher than the plasma pressure). Thus the lifetime of a plasmoid is expected to be on the order of the acoustic (or Alfvén) transit time.

Relativistic uniform system
In case when in the physical system the pressure field, the electromagnetic and gravitational fields are taken into account, as well as the field of particles’ acceleration, the virial theorem is written in the relativistic form as follows:
where the value Wk ≈ γcT exceeds the kinetic energy of the particles T by a factor equal to the Lorentz factor γc of the particles at the center of the system. Under normal conditions we can assume that γc ≈ 1, then we can see that in the virial theorem the kinetic energy is related to the potential energy not by the coefficient 1/2, but rather by the coefficient close to 0.6. The difference from the classical case arises due to considering the pressure field and the field of particles’ acceleration inside the system, while the derivative of the scalar G is not equal to zero and should be considered as the material derivative.
An analysis of the integral theorem of generalized virial makes it possible to find, on the basis of field theory, a formula for the root-mean-square speed of typical particles of a system without using the notion of temperature:
where 
  
    
      
         
        c
      
    
    {\displaystyle ~c}
   is the speed of light, 
  
    
      
         
        η
      
    
    {\displaystyle ~\eta }
   is the acceleration field constant, 
  
    
      
         
        
          ρ
          
            0
          
        
      
    
    {\displaystyle ~\rho _{0}}
   is the mass density of particles, 
  
    
      
         
        r
      
    
    {\displaystyle ~r}
   is the current radius.
Unlike the virial theorem for particles, for the electromagnetic field the virial theorem is written as follows:
where the energy 
  
    
      
         
        
          E
          
            k
            f
          
        
        =
        ∫
        
          A
          
            α
          
        
        
          j
          
            α
          
        
        
          
            −
            g
          
        
        
        d
        
          x
          
            1
          
        
        
        d
        
          x
          
            2
          
        
        
        d
        
          x
          
            3
          
        
      
    
    {\textstyle ~E_{kf}=\int A_{\alpha }j^{\alpha }{\sqrt {-g}}\,dx^{1}\,dx^{2}\,dx^{3}}
   considered as the kinetic field energy associated with four-current 
  
    
      
        
          j
          
            α
          
        
      
    
    {\displaystyle j^{\alpha }}
  , and

sets the potential field energy found through the components of the electromagnetic tensor.

In astrophysics
The virial theorem is frequently applied in astrophysics, especially relating the gravitational potential energy of a system to its kinetic or thermal energy. Some common virial relations are
for a mass M, radius R, velocity v, and temperature T. The constants are Newton's constant G, the Boltzmann constant kB, and proton mass mp. Note that these relations are only approximate, and often the leading numerical factors (e.g. 3/5 or 1/2) are neglected entirely.

Galaxies and cosmology (virial mass and radius)
In astronomy, the mass and size of a galaxy (or general overdensity) is often defined in terms of the "virial mass" and "virial radius" respectively. Because galaxies and overdensities in continuous fluids can be highly extended (even to infinity in some models, such as an isothermal sphere), it can be hard to define specific, finite measures of their mass and size. The virial theorem, and related concepts, provide an often convenient means by which to quantify these properties.
In galaxy dynamics, the mass of a galaxy is often inferred by measuring the rotation velocity of its gas and stars, assuming circular Keplerian orbits. Using the virial theorem, the velocity dispersion σ can be used in a similar way. Taking the kinetic energy (per particle) of the system as T = 1/2v2 ~ 3/2σ2, and the potential energy (per particle) as U ~ 3/5 GM/R we can write

Here 
  
    
      
        R
      
    
    {\displaystyle R}
   is the radius at which the velocity dispersion is being measured, and M is the mass within that radius. The virial mass and radius are generally defined for the radius at which the velocity dispersion is a maximum, i.e.

As numerous approximations have been made, in addition to the approximate nature of these definitions, order-unity proportionality constants are often omitted (as in the above equations). These relations are thus only accurate in an order of magnitude sense, or when used self-consistently.
An alternate definition of the virial mass and radius is often used in cosmology where it is used to refer to the radius of a sphere, centered on a galaxy or a galaxy cluster, within which virial equilibrium holds. Since this radius is difficult to determine observationally, it is often approximated as the radius within which the average density is greater, by a specified factor, than the critical density

where H is the Hubble parameter and G is the gravitational constant. A common choice for the factor is 200, which corresponds roughly to the typical over-density in spherical top-hat collapse (see Virial mass), in which case the virial radius is approximated as

The virial mass is then defined relative to this radius as

Stars
The virial theorem is applicable to the cores of stars, by establishing a relation between gravitational potential energy and thermal kinetic energy (i.e. temperature). As stars on the main sequence convert hydrogen into helium in their cores, the mean molecular weight of the core increases and it must contract to maintain enough pressure to support its own weight. This contraction decreases its potential energy and, the virial theorem states, increases its thermal energy. The core temperature increases even as energy is lost, effectively a negative specific heat. This continues beyond the main sequence, unless the core becomes degenerate since that causes the pressure to become independent of temperature and the virial relation with n equals −1 no longer holds.

See also
Virial coefficient
Virial stress
Virial mass
Chandrasekhar tensor
Chandrasekhar virial equations
Derrick's theorem
Equipartition theorem
Ehrenfest theorem
Pokhozhaev's identity

References
Further reading
Goldstein, H. (1980). Classical Mechanics (2nd ed.). Addison–Wesley. ISBN 978-0-201-02918-5.
Collins, G. W. (1978). The Virial Theorem in Stellar Astrophysics. Pachart Press. Bibcode:1978vtsa.book.....C. ISBN 978-0-912918-13-6.
i̇Pekoğlu, Y.; Turgut, S. (2016). "An elementary derivation of the quantum virial theorem from Hellmann–Feynman theorem". European Journal of Physics. 37 (4): 045405. Bibcode:2016EJPh...37d5405I. doi:10.1088/0143-0807/37/4/045405. S2CID 125030620.

External links
The Virial Theorem at MathPages
Gravitational Contraction and Star Formation, Georgia State University