Stochastic portfolio theory (SPT) is a mathematical theory for analyzing stock market structure and portfolio behavior introduced by E. Robert Fernholz in 2002.  It is descriptive as opposed to normative, and is consistent with the observed behavior of actual markets.  Normative assumptions, which serve as a basis for earlier theories like modern portfolio theory (MPT) and the capital asset pricing model (CAPM), are absent from SPT.
SPT uses continuous-time random processes (in particular, continuous semi-martingales) to represent the prices of individual securities.  Processes with discontinuities, such as jumps, have also been incorporated* into the theory (*unverifiable claim due to missing citation!).

Stocks, portfolios and markets
SPT considers stocks and stock markets, but its methods can be applied to other classes of assets as well.  A stock is represented by its price process, usually in the logarithmic representation.  In the case the market is a collection of stock-price processes 
  
    
      
        
          X
          
            i
          
        
        ,
      
    
    {\displaystyle X_{i},}
   for 
  
    
      
        i
        =
        1
        ,
        …
        ,
        n
        ,
      
    
    {\displaystyle i=1,\dots ,n,}
   each defined by a continuous semimartingale

  
    
      
        d
        log
        ⁡
        
          X
          
            i
          
        
        (
        t
        )
        =
        
          γ
          
            i
          
        
        (
        t
        )
        
        d
        t
        +
        
          ∑
          
            ν
            =
            1
          
          
            d
          
        
        
          ξ
          
            i
            ν
          
        
        (
        t
        )
        
        d
        
          W
          
            ν
          
        
        (
        t
        )
      
    
    {\displaystyle d\log X_{i}(t)=\gamma _{i}(t)\,dt+\sum _{\nu =1}^{d}\xi _{i\nu }(t)\,dW_{\nu }(t)}
  where 
  
    
      
        W
        :=
        (
        
          W
          
            1
          
        
        ,
        …
        ,
        
          W
          
            d
          
        
        )
      
    
    {\displaystyle W:=(W_{1},\dots ,W_{d})}
   is an 
  
    
      
        n
      
    
    {\displaystyle n}
  -dimensional  Brownian motion (Wiener) process with 
  
    
      
        d
        ≥
        n
      
    
    {\displaystyle d\geq n}
  , and the processes 
  
    
      
        
          γ
          
            i
          
        
      
    
    {\displaystyle \gamma _{i}}
   and 
  
    
      
        
          ξ
          
            i
            ν
          
        
      
    
    {\displaystyle \xi _{i\nu }}
   are progressively measurable with respect to the Brownian filtration

  
    
      
        {
        
          
            
              F
            
          
          
            t
          
        
        }
        =
        {
        
          
            
              F
            
          
          
            t
          
          
            W
          
        
        }
      
    
    {\displaystyle \{{\mathcal {F}}_{t}\}=\{{\mathcal {F}}_{t}^{W}\}}
  .  In this representation 
  
    
      
        
          γ
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle \gamma _{i}(t)}
   is called the (compound) growth rate of 
  
    
      
        
          X
          
            i
          
        
        ,
      
    
    {\displaystyle X_{i},}
   and the covariance between 
  
    
      
        log
        ⁡
        
          X
          
            i
          
        
      
    
    {\displaystyle \log X_{i}}
   and 
  
    
      
        log
        ⁡
        
          X
          
            j
          
        
      
    
    {\displaystyle \log X_{j}}
   is 
  
    
      
        
          σ
          
            i
            j
          
        
        (
        t
        )
        =
        
          ∑
          
            ν
            =
            1
          
          
            d
          
        
        
          ξ
          
            i
            ν
          
        
        (
        t
        )
        
          ξ
          
            j
            ν
          
        
        (
        t
        )
        .
      
    
    {\displaystyle \sigma _{ij}(t)=\sum _{\nu =1}^{d}\xi _{i\nu }(t)\xi _{j\nu }(t).}
    It is frequently assumed that, for all 
  
    
      
        i
        ,
      
    
    {\displaystyle i,}
   the process 
  
    
      
        
          ξ
          
            i
            ,
            1
          
          
            2
          
        
        (
        t
        )
        +
        ⋯
        +
        
          ξ
          
            i
            d
          
          
            2
          
        
        (
        t
        )
      
    
    {\displaystyle \xi _{i,1}^{2}(t)+\cdots +\xi _{id}^{2}(t)}
   is positive, locally square-integrable, and does not grow too rapidly as 
  
    
      
        t
        →
        ∞
        .
      
    
    {\displaystyle t\rightarrow \infty .}
  
The logarithmic representation is equivalent to the classical arithmetic representation which uses the rate of return 
  
    
      
        
          α
          
            i
          
        
        (
        t
        )
        ,
      
    
    {\displaystyle \alpha _{i}(t),}
   however the growth rate can be a meaningful indicator of long-term performance of a financial asset, whereas the rate of return has an upward bias. The relation between the rate of return and the growth rate is

  
    
      
        
          α
          
            i
          
        
        (
        t
        )
        =
        
          γ
          
            i
          
        
        (
        t
        )
        +
        
          
            
              
                σ
                
                  i
                  i
                
              
              (
              t
              )
            
            2
          
        
      
    
    {\displaystyle \alpha _{i}(t)=\gamma _{i}(t)+{\frac {\sigma _{ii}(t)}{2}}}
  The usual convention in SPT is to assume that each stock has a single share outstanding, so 
  
    
      
        
          X
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle X_{i}(t)}
  
represents the total capitalization of the 
  
    
      
        i
      
    
    {\displaystyle i}
  -th stock at time 
  
    
      
        t
        ,
      
    
    {\displaystyle t,}
   and 

  
    
      
        X
        (
        t
        )
        =
        
          X
          
            1
          
        
        (
        t
        )
        +
        ⋯
        +
        
          X
          
            n
          
        
        (
        t
        )
      
    
    {\displaystyle X(t)=X_{1}(t)+\cdots +X_{n}(t)}
   is the total capitalization of the market. 
Dividends can be included in this representation, but are omitted here for simplicity.
An investment strategy 
  
    
      
        π
        =
        (
        
          π
          
            1
          
        
        ,
        ⋯
        ,
        
          π
          
            n
          
        
        )
      
    
    {\displaystyle \pi =(\pi _{1},\cdots ,\pi _{n})}
   is a vector of bounded, progressively measurable
processes; the quantity 
  
    
      
        
          π
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle \pi _{i}(t)}
   represents the proportion of total wealth invested in the 
  
    
      
        i
      
    
    {\displaystyle i}
  -th stock at
time 
  
    
      
        t
      
    
    {\displaystyle t}
  , and 
  
    
      
        
          π
          
            0
          
        
        (
        t
        )
        :=
        1
        −
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          π
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle \pi _{0}(t):=1-\sum _{i=1}^{n}\pi _{i}(t)}
   is the proportion hoarded (invested in a money market with zero interest rate). Negative weights correspond to short positions. The cash strategy 
  
    
      
        κ
        ≡
        0
        (
        
          κ
          
            0
          
        
        ≡
        1
        )
      
    
    {\displaystyle \kappa \equiv 0(\kappa _{0}\equiv 1)}
   keeps all wealth in the money market. A strategy 
  
    
      
        π
      
    
    {\displaystyle \pi }
   is called portfolio, if it is fully invested in the stock market, that is 
  
    
      
        
          π
          
            1
          
        
        (
        t
        )
        +
        ⋯
        +
        
          π
          
            n
          
        
        (
        t
        )
        =
        1
      
    
    {\displaystyle \pi _{1}(t)+\cdots +\pi _{n}(t)=1}
   holds, at all times.
The value process 
  
    
      
        
          Z
          
            π
          
        
      
    
    {\displaystyle Z_{\pi }}
   of a strategy 
  
    
      
        π
      
    
    {\displaystyle \pi }
   is always positive and satisfies

  
    
      
        d
        log
        ⁡
        
          Z
          
            π
          
        
        (
        t
        )
        =
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          π
          
            i
          
        
        (
        t
        )
        
        d
        log
        ⁡
        
          X
          
            i
          
        
        (
        t
        )
        +
        
          γ
          
            π
          
          
            ∗
          
        
        (
        t
        )
        
        d
        t
      
    
    {\displaystyle d\log Z_{\pi }(t)=\sum _{i=1}^{n}\pi _{i}(t)\,d\log X_{i}(t)+\gamma _{\pi }^{*}(t)\,dt}
  where the process 
  
    
      
        
          γ
          
            π
          
          
            ∗
          
        
      
    
    {\displaystyle \gamma _{\pi }^{*}}
   is called the excess growth rate process and is given by

  
    
      
        
          γ
          
            π
          
          
            ∗
          
        
        (
        t
        )
        :=
        
          
            1
            2
          
        
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          π
          
            i
          
        
        (
        t
        )
        
          σ
          
            i
            i
          
        
        (
        t
        )
        −
        
          
            1
            2
          
        
        
          ∑
          
            i
            ,
            j
            =
            1
          
          
            n
          
        
        
          π
          
            i
          
        
        (
        t
        )
        
          π
          
            j
          
        
        (
        t
        )
        
          σ
          
            i
            j
          
        
        (
        t
        )
      
    
    {\displaystyle \gamma _{\pi }^{*}(t):={\frac {1}{2}}\sum _{i=1}^{n}\pi _{i}(t)\sigma _{ii}(t)-{\frac {1}{2}}\sum _{i,j=1}^{n}\pi _{i}(t)\pi _{j}(t)\sigma _{ij}(t)}
  This expression is non-negative for a portfolio with non-negative weights 
  
    
      
        
          π
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle \pi _{i}(t)}
   and has been used
in quadratic optimization of stock portfolios, a special case of which is optimization with respect to the logarithmic utility function.
The market weight processes,

  
    
      
        
          μ
          
            i
          
        
        (
        t
        )
        :=
        
          
            
              
                X
                
                  i
                
              
              (
              t
              )
            
            
              
                X
                
                  1
                
              
              (
              t
              )
              +
              ⋯
              +
              
                X
                
                  n
                
              
              (
              t
              )
            
          
        
      
    
    {\displaystyle \mu _{i}(t):={\frac {X_{i}(t)}{X_{1}(t)+\cdots +X_{n}(t)}}}
  where 
  
    
      
        i
        =
        1
        ,
        …
        ,
        n
      
    
    {\displaystyle i=1,\dots ,n}
   define the market portfolio 
  
    
      
        μ
      
    
    {\displaystyle \mu }
  .  With the initial condition 
  
    
      
        
          Z
          
            μ
          
        
        (
        0
        )
        =
        X
        (
        0
        )
        ,
      
    
    {\displaystyle Z_{\mu }(0)=X(0),}
   the associated value process will satisfy 
  
    
      
        
          Z
          
            μ
          
        
        (
        t
        )
        =
        X
        (
        t
        )
      
    
    {\displaystyle Z_{\mu }(t)=X(t)}
   for all 
  
    
      
        t
        .
      
    
    {\displaystyle t.}
    

A number of conditions can be imposed on a market, sometimes to model actual markets and sometimes to emphasize certain types of hypothetical market behavior.  Some commonly invoked conditions are:

A market is nondegenerate if the eigenvalues of the covariance matrix 
  
    
      
        (
        
          σ
          
            i
            j
          
        
        (
        t
        )
        
          )
          
            1
            ≤
            i
            ,
            j
            ≤
            n
          
        
      
    
    {\displaystyle (\sigma _{ij}(t))_{1\leq i,j\leq n}}
   are bounded away from zero. It has bounded variance if the eigenvalues are bounded.
A market is coherent if 
  
    
      
        
          lim
          
            t
            →
            ∞
          
        
        ⁡
        
          t
          
            −
            1
          
        
        log
        ⁡
        (
        
          μ
          
            i
          
        
        (
        t
        )
        )
        =
        0
      
    
    {\displaystyle \operatorname {lim} _{t\rightarrow \infty }t^{-1}\log(\mu _{i}(t))=0}
   for all 
  
    
      
        i
        =
        1
        ,
        …
        ,
        n
        .
      
    
    {\displaystyle i=1,\dots ,n.}
  
A market is diverse on 
  
    
      
        [
        0
        ,
        T
        ]
      
    
    {\displaystyle [0,T]}
   if there exists 
  
    
      
        ε
        >
        0
      
    
    {\displaystyle \varepsilon >0}
   such that 
  
    
      
        
          μ
          
            max
          
        
        (
        t
        )
        ≤
        1
        −
        ε
      
    
    {\displaystyle \mu _{\max }(t)\leq 1-\varepsilon }
   for 
  
    
      
        t
        ∈
        [
        0
        ,
        T
        ]
        .
      
    
    {\displaystyle t\in [0,T].}
  
A market is weakly diverse on 
  
    
      
        [
        0
        ,
        T
        ]
      
    
    {\displaystyle [0,T]}
   if there exists 
  
    
      
        ε
        >
        0
      
    
    {\displaystyle \varepsilon >0}
   such that
  
    
      
        
          
            1
            T
          
        
        
          ∫
          
            0
          
          
            T
          
        
        
          μ
          
            max
          
        
        (
        t
        )
        
        d
        t
        ≤
        1
        −
        ε
      
    
    {\displaystyle {\frac {1}{T}}\int _{0}^{T}\mu _{\max }(t)\,dt\leq 1-\varepsilon }
  
Diversity and weak diversity are rather weak conditions, and markets are generally far more diverse than would be tested by these extremes. A measure of market diversity is market entropy, defined by 

  
    
      
        S
        (
        μ
        (
        t
        )
        )
        =
        −
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          μ
          
            i
          
        
        (
        t
        )
        log
        ⁡
        (
        
          μ
          
            i
          
        
        (
        t
        )
        )
        .
      
    
    {\displaystyle S(\mu (t))=-\sum _{i=1}^{n}\mu _{i}(t)\log(\mu _{i}(t)).}

Stochastic stability
We consider the vector process 
  
    
      
        (
        
          μ
          
            (
            1
            )
          
        
        (
        t
        )
        ,
        …
        ,
        
          μ
          
            (
            n
            )
          
        
        (
        t
        )
        )
        ,
      
    
    {\displaystyle (\mu _{(1)}(t),\dots ,\mu _{(n)}(t)),}
   with 
  
    
      
        0
        ≤
        t
        <
        ∞
      
    
    {\displaystyle 0\leq t<\infty }
   of ranked market weights

  
    
      
        
          max
          
            1
            ≤
            i
            ≤
            n
          
        
        
          μ
          
            i
          
        
        (
        t
        )
        =:
        
          μ
          
            (
            1
            )
          
        
        (
        t
        )
        ≥
        
          μ
          
            (
            2
            )
          
        
        (
        t
        )
        ≥
        ⋯
        
          μ
          
            (
            n
            )
          
        
        (
        t
        )
        :=
        
          min
          
            1
            ≤
            i
            ≤
            n
          
        
        
          μ
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle \max _{1\leq i\leq n}\mu _{i}(t)=:\mu _{(1)}(t)\geq \mu _{(2)}(t)\geq \cdots \mu _{(n)}(t):=\min _{1\leq i\leq n}\mu _{i}(t)}
  where ties are resolved “lexicographically”, always in favor of the lowest index. The log-gaps

  
    
      
        
          G
          
            (
            k
            ,
            k
            +
            1
            )
          
        
        (
        t
        )
        :=
        log
        ⁡
        (
        
          μ
          
            (
            k
            )
          
        
        (
        t
        )
        
          /
        
        
          μ
          
            (
            k
            +
            1
            )
          
        
        (
        t
        )
        )
        ,
      
    
    {\displaystyle G^{(k,k+1)}(t):=\log(\mu _{(k)}(t)/\mu _{(k+1)}(t)),}
  where 
  
    
      
        0
        ≤
        t
        <
        ∞
      
    
    {\displaystyle 0\leq t<\infty }
   and 
  
    
      
        k
        =
        1
        ,
        …
        ,
        n
        −
        1
      
    
    {\displaystyle k=1,\dots ,n-1}
   are continuous, non-negative semimartingales; we denote by 
  
    
      
        
          Λ
          
            (
            k
            ,
            k
            +
            1
            )
          
        
        (
        t
        )
        =
        
          L
          
            
              G
              
                (
                k
                ,
                k
                +
                1
                )
              
            
          
        
        (
        t
        ;
        0
        )
      
    
    {\displaystyle \Lambda ^{(k,k+1)}(t)=L^{G^{(k,k+1)}}(t;0)}
   their local times at the origin. These quantities measure the amount of turnover between ranks 
  
    
      
        k
      
    
    {\displaystyle k}
   and 
  
    
      
        k
        +
        1
      
    
    {\displaystyle k+1}
   during the time-interval 
  
    
      
        [
        0
        ,
        t
        ]
      
    
    {\displaystyle [0,t]}
  .
A market is called stochastically stable, if 
  
    
      
        (
        
          μ
          
            (
            1
            )
          
        
        (
        t
        )
        ,
        ⋯
        ,
        
          μ
          
            (
            n
            )
          
        
        (
        t
        )
        )
      
    
    {\displaystyle (\mu _{(1)}(t),\cdots ,\mu _{(n)}(t))}
   converges in distribution as 
  
    
      
        t
        →
        ∞
      
    
    {\displaystyle t\rightarrow \infty }
   to a random vector 
  
    
      
        (
        
          M
          
            (
            1
            )
          
        
        ,
        ⋯
        ,
        
          M
          
            (
            n
            )
          
        
        )
      
    
    {\displaystyle (M_{(1)},\cdots ,M_{(n)})}
   with values in the Weyl chamber 

  
    
      
        {
        (
        
          x
          
            1
          
        
        ,
        …
        ,
        
          x
          
            n
          
        
        )
        ∣
        
          x
          
            1
          
        
        >
        
          x
          
            2
          
        
        >
        ⋯
        >
        
          x
          
            n
          
        
        
           and 
        
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          x
          
            i
          
        
        =
        1
        }
      
    
    {\displaystyle \{(x_{1},\dots ,x_{n})\mid x_{1}>x_{2}>\dots >x_{n}{\text{ and }}\sum _{i=1}^{n}x_{i}=1\}}
   
of the unit simplex, and if the strong law of large numbers

  
    
      
        
          lim
          
            t
            →
            ∞
          
        
        
          
            
              
                Λ
                
                  (
                  k
                  ,
                  k
                  +
                  1
                  )
                
              
              (
              t
              )
            
            t
          
        
        =
        
          λ
          
            (
            k
            ,
            k
            +
            1
            )
          
        
        >
        0
      
    
    {\displaystyle \lim _{t\rightarrow \infty }{\frac {\Lambda ^{(k,k+1)}(t)}{t}}=\lambda ^{(k,k+1)}>0}
  holds for suitable real constants 
  
    
      
        
          λ
          
            (
            1
            ,
            2
            )
          
        
        ,
        …
        ,
        
          λ
          
            (
            n
            −
            1
            ,
            n
            )
          
        
        .
      
    
    {\displaystyle \lambda ^{(1,2)},\dots ,\lambda ^{(n-1,n)}.}

Arbitrage and the numeraire property
Given any two investment strategies 
  
    
      
        π
        ,
        ρ
      
    
    {\displaystyle \pi ,\rho }
   and a real number 
  
    
      
        T
        >
        0
      
    
    {\displaystyle T>0}
  , we say that 
  
    
      
        π
      
    
    {\displaystyle \pi }
   is arbitrage relative to 
  
    
      
        ρ
      
    
    {\displaystyle \rho }
   over the time-horizon 
  
    
      
        [
        0
        ,
        T
        ]
      
    
    {\displaystyle [0,T]}
  , if 
  
    
      
        
          P
        
        (
        
          Z
          
            π
          
        
        (
        T
        )
        ≥
        
          Z
          
            ρ
          
        
        (
        T
        )
        )
        ≥
        1
      
    
    {\displaystyle \mathbb {P} (Z_{\pi }(T)\geq Z_{\rho }(T))\geq 1}
    and 
  
    
      
        
          P
        
        (
        
          Z
          
            π
          
        
        (
        T
        )
        >
        
          Z
          
            ρ
          
        
        (
        T
        )
        )
        >
        0
      
    
    {\displaystyle \mathbb {P} (Z_{\pi }(T)>Z_{\rho }(T))>0}
   both hold; this relative arbitrage is called “strong” if 
  
    
      
        
          P
        
        (
        
          Z
          
            π
          
        
        (
        T
        )
        >
        
          Z
          
            ρ
          
        
        (
        T
        )
        )
        =
        1.
      
    
    {\displaystyle \mathbb {P} (Z_{\pi }(T)>Z_{\rho }(T))=1.}
    When 
  
    
      
        ρ
      
    
    {\displaystyle \rho }
   is 
  
    
      
        κ
        ≡
        0
        ,
      
    
    {\displaystyle \kappa \equiv 0,}
   we recover the usual definition of arbitrage relative to cash.
We say that a given strategy 
  
    
      
        ν
      
    
    {\displaystyle \nu }
   has the numeraire property, if for any strategy 
  
    
      
        π
      
    
    {\displaystyle \pi }
   the ratio 
  
    
      
        
          Z
          
            π
          
        
        
          /
        
        
          Z
          
            ν
          
        
      
    
    {\displaystyle Z_{\pi }/Z_{\nu }}
   is a 
  
    
      
        
          P
        
      
    
    {\displaystyle \mathbb {P} }
  −supermartingale. In such a case, the process 
  
    
      
        1
        
          /
        
        
          Z
          
            ν
          
        
      
    
    {\displaystyle 1/Z_{\nu }}
   is called a “deflator” for the market.
No arbitrage is possible, over any given time horizon, relative to a strategy 
  
    
      
        ν
      
    
    {\displaystyle \nu }
   that has the numeraire property (either with respect to the underlying probability measure 
  
    
      
        
          P
        
      
    
    {\displaystyle \mathbb {P} }
  , or with respect to any other probability measure which is equivalent to 
  
    
      
        
          P
        
      
    
    {\displaystyle \mathbb {P} }
  ). A strategy 
  
    
      
        ν
      
    
    {\displaystyle \nu }
   with the numeraire property maximizes the asymptotic growth rate from investment, in the sense that

  
    
      
        
          lim sup
          
            T
            →
            ∞
          
        
        
          
            1
            T
          
        
        log
        ⁡
        
          (
          
            
              
                
                  Z
                  
                    π
                  
                
                (
                T
                )
              
              
                
                  Z
                  
                    ν
                  
                
                (
                T
                )
              
            
          
          )
        
        ≤
        0
      
    
    {\displaystyle \limsup _{T\rightarrow \infty }{\frac {1}{T}}\log \left({\frac {Z_{\pi }(T)}{Z_{\nu }(T)}}\right)\leq 0}
  holds for any strategy 
  
    
      
        π
      
    
    {\displaystyle \pi }
  ; it also maximizes the expected log-utility from investment, in the sense that for any strategy 
  
    
      
        π
      
    
    {\displaystyle \pi }
   and real number 
  
    
      
        T
        >
        0
      
    
    {\displaystyle T>0}
   we have

  
    
      
        
          E
        
        [
        log
        ⁡
        (
        
          Z
          
            π
          
        
        (
        T
        )
        ]
        ≤
        
          E
        
        [
        log
        ⁡
        (
        
          Z
          
            ν
          
        
        (
        T
        )
        )
        ]
        .
      
    
    {\displaystyle \mathbb {E} [\log(Z_{\pi }(T)]\leq \mathbb {E} [\log(Z_{\nu }(T))].}
  If the vector 
  
    
      
        α
        (
        t
        )
        =
        (
        
          α
          
            1
          
        
        (
        t
        )
        ,
        ⋯
        ,
        
          α
          
            n
          
        
        (
        t
        )
        
          )
          ′
        
      
    
    {\displaystyle \alpha (t)=(\alpha _{1}(t),\cdots ,\alpha _{n}(t))'}
   of instantaneous rates of return, and the matrix 
  
    
      
        σ
        (
        t
        )
        =
        (
        σ
        (
        t
        )
        
          )
          
            1
            ≤
            i
            ,
            j
            ≤
            n
          
        
      
    
    {\displaystyle \sigma (t)=(\sigma (t))_{1\leq i,j\leq n}}
   of instantaneous covariances, are known, then the strategy

  
    
      
        ν
        (
        t
        )
        =
        arg
        ⁡
        
          max
          
            p
            ∈
            
              
                R
              
              
                n
              
            
          
        
        (
        
          p
          ′
        
        α
        (
        t
        )
        −
        
          
            
              1
              2
            
          
        
        
          p
          ′
        
        α
        (
        t
        )
        p
        )
        
        
           for all 
        
        0
        ≤
        t
        <
        ∞
      
    
    {\displaystyle \nu (t)=\arg \max _{p\in \mathbb {R} ^{n}}(p'\alpha (t)-{\tfrac {1}{2}}p'\alpha (t)p)\qquad {\text{ for all }}0\leq t<\infty }
  has the numeraire property whenever the indicated maximum is attained.
The study of the numeraire portfolio links SPT to the so-called Benchmark approach to Mathematical Finance, which takes such a numeraire portfolio as given and provides a way to price contingent claims, without any further assumptions.
A probability measure 
  
    
      
        
          Q
        
      
    
    {\displaystyle \mathbb {Q} }
   is called equivalent martingale measure (EMM) on a given time-horizon 
  
    
      
        [
        0
        ,
        T
        ]
      
    
    {\displaystyle [0,T]}
  , if it has the same null sets as 
  
    
      
        
          P
        
      
    
    {\displaystyle \mathbb {P} }
   on 
  
    
      
        
          
            
              F
            
          
          
            T
          
        
      
    
    {\displaystyle {\mathcal {F}}_{T}}
  , and if the processes 
  
    
      
        
          X
          
            1
          
        
        (
        t
        )
        ,
        …
        ,
        
          X
          
            n
          
        
        (
        t
        )
      
    
    {\displaystyle X_{1}(t),\dots ,X_{n}(t)}
   with 
  
    
      
        0
        ≤
        t
        ≤
        T
      
    
    {\displaystyle 0\leq t\leq T}
   are all 
  
    
      
        
          Q
        
      
    
    {\displaystyle \mathbb {Q} }
  −martingales. Assuming that such an EMM exists, arbitrage is not possible on 
  
    
      
        [
        0
        ,
        T
        ]
      
    
    {\displaystyle [0,T]}
   relative to either cash 
  
    
      
        κ
      
    
    {\displaystyle \kappa }
   or to the market portfolio 
  
    
      
        μ
      
    
    {\displaystyle \mu }
   (or more generally, relative to any
strategy 
  
    
      
        ρ
      
    
    {\displaystyle \rho }
   whose wealth process 
  
    
      
        
          Z
          
            ρ
          
        
      
    
    {\displaystyle Z_{\rho }}
   is a martingale under some EMM). Conversely, if 
  
    
      
        π
        ,
        ρ
      
    
    {\displaystyle \pi ,\rho }
   are portfolios and one of them is arbitrage relative to the other on 
  
    
      
        [
        0
        ,
        T
        ]
      
    
    {\displaystyle [0,T]}
   then no EMM can exist on this horizon.

Functionally-generated portfolios
Suppose we are given a smooth function 
  
    
      
        G
        :
        U
        →
        (
        0
        ,
        ∞
        )
      
    
    {\displaystyle G:U\rightarrow (0,\infty )}
   on some neighborhood 

  
    
      
        U
      
    
    {\displaystyle U}
   of the unit simplex in 
  
    
      
        
          
            R
          
          
            n
          
        
      
    
    {\displaystyle \mathbb {R} ^{n}}
   . We call

  
    
      
        
          π
          
            i
          
          
            
              G
            
          
        
        (
        t
        )
        :=
        
          μ
          
            i
          
        
        (
        t
        )
        
          (
          
            
              D
              
                i
              
            
            log
            ⁡
            (
            
              G
            
            (
            μ
            (
            t
            )
            )
            )
            +
            1
            −
            
              ∑
              
                j
                =
                1
              
              
                n
              
            
            
              μ
              
                j
              
            
            (
            t
            )
            
              D
              
                j
              
            
            log
            ⁡
            (
            
              G
            
            (
            μ
            (
            t
            )
            )
            )
          
          )
        
        
        
           for 
        
        1
        ≤
        i
        ≤
        n
      
    
    {\displaystyle \pi _{i}^{\mathbb {G} }(t):=\mu _{i}(t)\left(D_{i}\log(\mathbb {G} (\mu (t)))+1-\sum _{j=1}^{n}\mu _{j}(t)D_{j}\log(\mathbb {G} (\mu (t)))\right)\qquad {\text{ for }}1\leq i\leq n}
  the portfolio generated by the function 
  
    
      
        
          G
        
      
    
    {\displaystyle \mathbb {G} }
  . It can be shown that all the weights of this portfolio are non-negative, if its generating function 
  
    
      
        
          G
        
      
    
    {\displaystyle \mathbb {G} }
   is concave. Under mild conditions, the relative performance of this functionally-generated portfolio 
  
    
      
        
          π
          
            
              G
            
          
        
      
    
    {\displaystyle \pi _{\mathbb {G} }}
   with respect to the market portfolio 
  
    
      
        μ
      
    
    {\displaystyle \mu }
  , is given by the F-G decomposition

  
    
      
        log
        ⁡
        
          (
          
            
              
                
                  Z
                  
                    
                      π
                      
                        
                          G
                        
                      
                    
                  
                
                (
                T
                )
              
              
                
                  Z
                  
                    μ
                  
                
                (
                T
                )
              
            
          
          )
        
        =
        log
        ⁡
        
          (
          
            
              
                
                  G
                
                (
                μ
                (
                T
                )
                )
              
              
                
                  G
                
                (
                μ
                (
                0
                )
                )
              
            
          
          )
        
        +
        
          ∫
          
            0
          
          
            T
          
        
        g
        (
        t
        )
        
        d
        t
      
    
    {\displaystyle \log \left({\frac {Z_{\pi ^{\mathbb {G} }}(T)}{Z_{\mu }(T)}}\right)=\log \left({\frac {\mathbb {G} (\mu (T))}{\mathbb {G} (\mu (0))}}\right)+\int _{0}^{T}g(t)\,dt}
  which involves no stochastic integrals.  Here the expression 

  
    
      
        g
        (
        t
        )
        :=
        
          
            
              −
              1
            
            
              2
              
                G
              
              (
              μ
              (
              t
              )
              )
            
          
        
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          ∑
          
            j
            =
            1
          
          
            n
          
        
        
          D
          
            i
            j
          
          
            2
          
        
        
          G
        
        (
        μ
        (
        t
        )
        )
        
          μ
          
            i
          
        
        (
        t
        )
        
          μ
          
            j
          
        
        (
        t
        )
        
          τ
          
            i
            j
          
          
            μ
          
        
        (
        t
        )
      
    
    {\displaystyle g(t):={\frac {-1}{2\mathbb {G} (\mu (t))}}\sum _{i=1}^{n}\sum _{j=1}^{n}D_{ij}^{2}\mathbb {G} (\mu (t))\mu _{i}(t)\mu _{j}(t)\tau _{ij}^{\mu }(t)}
  is called the drift process of the portfolio (and it is a non-negative quantity if the generating function 
  
    
      
        
          G
        
      
    
    {\displaystyle \mathbb {G} }
   is concave); and the quantities 

  
    
      
        
          τ
          
            i
            j
          
          
            μ
          
        
        (
        t
        )
        :=
        
          ∑
          
            ν
            =
            1
          
          
            n
          
        
        (
        
          ξ
          
            i
            ν
          
        
        (
        t
        )
        −
        
          ξ
          
            ν
          
          
            μ
          
        
        (
        t
        )
        )
        (
        
          ξ
          
            j
            ν
          
        
        (
        t
        )
        −
        
          ξ
          
            ν
          
          
            μ
          
        
        (
        t
        )
        )
        ,
        
        
          ξ
          
            i
            ν
          
        
        (
        t
        )
        :=
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          μ
          
            i
          
        
        (
        t
        )
        
          ξ
          
            i
            ν
          
        
        (
        t
        )
      
    
    {\displaystyle \tau _{ij}^{\mu }(t):=\sum _{\nu =1}^{n}(\xi _{i\nu }(t)-\xi _{\nu }^{\mu }(t))(\xi _{j\nu }(t)-\xi _{\nu }^{\mu }(t)),\qquad \xi _{i\nu }(t):=\sum _{i=1}^{n}\mu _{i}(t)\xi _{i\nu }(t)}
  with 
  
    
      
        1
        ≤
        i
        ,
        j
        ≤
        n
      
    
    {\displaystyle 1\leq i,j\leq n}
   are called the relative covariances between 
  
    
      
        log
        ⁡
        (
        
          X
          
            i
          
        
        )
      
    
    {\displaystyle \log(X_{i})}
   and 
  
    
      
        log
        ⁡
        (
        
          X
          
            j
          
        
        )
      
    
    {\displaystyle \log(X_{j})}
   with respect to the market.

Examples
The constant function 
  
    
      
        
          G
        
        :=
        w
        >
        0
      
    
    {\displaystyle \mathbb {G} :=w>0}
   generates the market portfolio 
  
    
      
        μ
      
    
    {\displaystyle \mu }
  ,
The geometric mean function 
  
    
      
        
          H
        
        (
        x
        )
        :=
        (
        
          x
          
            1
          
        
        ⋯
        
          x
          
            n
          
        
        
          )
          
            
              1
              n
            
          
        
      
    
    {\displaystyle \mathbb {H} (x):=(x_{1}\cdots x_{n})^{\frac {1}{n}}}
   generates the equal-weighted portfolio 
  
    
      
        
          φ
          
            i
          
        
        (
        n
        )
        =
        
          
            1
            n
          
        
      
    
    {\displaystyle \varphi _{i}(n)={\frac {1}{n}}}
   for all 
  
    
      
        1
        ≤
        i
        ≤
        n
      
    
    {\displaystyle 1\leq i\leq n}
  ,
The modified entropy function 
  
    
      
        
          
            S
          
          
            c
          
        
        (
        x
        )
        =
        c
        −
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          x
          
            i
          
        
        ⋅
        log
        ⁡
        (
        
          x
          
            i
          
        
        )
      
    
    {\displaystyle \mathbb {S} ^{c}(x)=c-\sum _{i=1}^{n}x_{i}\cdot \log(x_{i})}
   for any 
  
    
      
        c
        >
        0
      
    
    {\displaystyle c>0}
   generates the modified entropy-weighted portfolio,
The function 
  
    
      
        
          
            D
          
          
            (
            p
            )
          
        
        (
        x
        )
        :=
        (
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          x
          
            i
          
          
            p
          
        
        
          )
          
            
              1
              p
            
          
        
      
    
    {\displaystyle \mathbb {D} ^{(p)}(x):=(\sum _{i=1}^{n}x_{i}^{p})^{\frac {1}{p}}}
   with 
  
    
      
        0
        <
        p
        <
        1
      
    
    {\displaystyle 0<p<1}
   generates the diversity-weighted portfolio 
  
    
      
        
          δ
          
            i
          
          
            (
            p
            )
          
        
        (
        t
        )
        =
        
          
            
              (
              
                μ
                
                  i
                
              
              (
              t
              )
              
                )
                
                  p
                
              
            
            
              
                ∑
                
                  i
                  =
                  1
                
                
                  n
                
              
              (
              
                μ
                
                  i
                
              
              (
              t
              )
              
                )
                
                  p
                
              
            
          
        
      
    
    {\displaystyle \delta _{i}^{(p)}(t)={\frac {(\mu _{i}(t))^{p}}{\sum _{i=1}^{n}(\mu _{i}(t))^{p}}}}
   with drift process 
  
    
      
        (
        1
        −
        p
        )
        
          γ
          
            
              δ
              
                (
                p
                )
              
            
          
          
            ∗
          
        
        (
        t
        )
      
    
    {\displaystyle (1-p)\gamma _{\delta ^{(p)}}^{*}(t)}
  .

Arbitrage relative to the market
The excess growth rate of the market portfolio admits
the representation 
  
    
      
        2
        
          γ
          
            μ
          
          
            ∗
          
        
        (
        t
        )
        =
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          μ
          
            i
          
        
        (
        t
        )
        
          τ
          
            i
            i
          
          
            μ
          
        
        (
        t
        )
      
    
    {\displaystyle 2\gamma _{\mu }^{*}(t)=\sum _{i=1}^{n}\mu _{i}(t)\tau _{ii}^{\mu }(t)}
   as a capitalization-weighted average relative stock
variance. This quantity is nonnegative; if it happens to be bounded away from zero, namely

  
    
      
        
          γ
          
            μ
          
          
            ∗
          
        
        (
        t
        )
        =
        
          
            1
            2
          
        
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          μ
          
            i
          
        
        (
        t
        )
        
          τ
          
            i
            i
          
          
            μ
          
        
        (
        t
        )
        ≥
        h
        >
        0
        ,
      
    
    {\displaystyle \gamma _{\mu }^{*}(t)={\frac {1}{2}}\sum _{i=1}^{n}\mu _{i}(t)\tau _{ii}^{\mu }(t)\geq h>0,}
  for all 
  
    
      
        0
        ≤
        t
        <
        ∞
      
    
    {\displaystyle 0\leq t<\infty }
   for some real constant 
  
    
      
        h
      
    
    {\displaystyle h}
  , then it can be shown using the F-G decomposition that, 
for every 
  
    
      
        T
        >
        
          S
        
        (
        μ
        (
        0
        )
        )
        
          /
        
        h
        ,
      
    
    {\displaystyle T>\mathbb {S} (\mu (0))/h,}
   there exists a constant 
  
    
      
        c
        >
        0
      
    
    {\displaystyle c>0}
   for which the modified entropic portfolio 
  
    
      
        
          Θ
          
            (
            c
            )
          
        
      
    
    {\displaystyle \Theta ^{(c)}}
   is strict arbitrage relative to the market 
  
    
      
        μ
      
    
    {\displaystyle \mu }
   over 
  
    
      
        [
        0
        ,
        T
        ]
      
    
    {\displaystyle [0,T]}
  ; see Fernholz and Karatzas (2005) for details. It is an
open question, whether such arbitrage exists over arbitrary time horizons (for two special cases, in
which the answer to this question turns out to be affirmative, please see the paragraph below and
the next section).
If the eigenvalues of the covariance matrix 
  
    
      
        (
        
          σ
          
            i
            j
          
        
        (
        t
        )
        
          )
          
            1
            ≤
            i
            ,
            j
            ≤
            n
          
        
      
    
    {\displaystyle (\sigma _{ij}(t))_{1\leq i,j\leq n}}
   are bounded away from both zero and infinity, the condition 
  
    
      
        
          γ
          
            μ
          
          
            ∗
          
        
        ≥
        h
        >
        0
      
    
    {\displaystyle \gamma _{\mu }^{*}\geq h>0}
   can be shown to be equivalent to diversity, namely 
  
    
      
        
          μ
          
            max
          
        
        ≤
        1
        −
        ε
      
    
    {\displaystyle \mu _{\max }\leq 1-\varepsilon }
   for a suitable 
  
    
      
        ε
        ∈
        (
        0
        ,
        1
        )
        .
      
    
    {\displaystyle \varepsilon \in (0,1).}
   Then the diversity-weighted portfolio 
  
    
      
        
          δ
          
            (
            p
            )
          
        
      
    
    {\displaystyle \delta ^{(p)}}
   leads to strict arbitrage
relative to the market portfolio over sufficiently long time horizons; whereas, suitable modifications
of this diversity-weighted portfolio realize such strict arbitrage over arbitrary time horizons.

An example: volatility-stabilized markets
We consider the example of a system of stochastic differential equations

  
    
      
        d
        log
        ⁡
        (
        
          X
          
            i
          
        
        (
        t
        )
        )
        =
        
          
            α
            
              2
              
                μ
                
                  i
                
              
              (
              t
              )
            
          
        
        
        d
        t
        +
        
          
            σ
            
              
                μ
                
                  i
                
              
              (
              t
              )
            
          
        
        
        d
        
          W
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle d\log(X_{i}(t))={\frac {\alpha }{2\mu _{i}(t)}}\,dt+{\frac {\sigma }{\mu _{i}(t)}}\,dW_{i}(t)}
  with 
  
    
      
        1
        ≤
        i
        ≤
        n
      
    
    {\displaystyle 1\leq i\leq n}
   given real constants 
  
    
      
        α
        ≥
        0
      
    
    {\displaystyle \alpha \geq 0}
   and an 
  
    
      
        n
      
    
    {\displaystyle n}
  -dimensional Brownian motion 

  
    
      
        (
        
          W
          
            1
          
        
        ,
        …
        ,
        
          W
          
            n
          
        
        )
        .
      
    
    {\displaystyle (W_{1},\dots ,W_{n}).}
   It follows from the work of Bass and Perkins (2002) that this system has a weak solution, which is unique in distribution. Fernholz and Karatzas (2005) show how to construct this solution in terms of scaled and time-changed squared Bessel processes, and prove that the resulting system is coherent.
The total market capitalization 
  
    
      
        X
      
    
    {\displaystyle X}
   behaves here as geometric Brownian motion with drift, and has the same constant growth rate as the largest stock; whereas the excess growth rate of the market
portfolio is a positive constant. On the other hand, the relative market weights 
  
    
      
        
          μ
          
            i
          
        
      
    
    {\displaystyle \mu _{i}}
  
with 
  
    
      
        1
        ≤
        i
        ≤
        n
      
    
    {\displaystyle 1\leq i\leq n}
   have the dynamics of multi-allele Wright-Fisher processes. 
This model is an example of a non-diverse market with unbounded variances, in which strong arbitrage opportunities with respect to the market portfolio 
  
    
      
        μ
      
    
    {\displaystyle \mu }
   exist over arbitrary time horizons, as was shown by Banner and Fernholz (2008). Moreover, Pal (2012) derived the joint density of market weights at fixed times and at certain stopping times.

Rank-based portfolios
We fix an integer 
  
    
      
        m
        ∈
        {
        2
        ,
        …
        ,
        n
        −
        1
        }
      
    
    {\displaystyle m\in \{2,\dots ,n-1\}}
   and construct two capitalization-weighted portfolios: one consisting of the top 
  
    
      
        m
      
    
    {\displaystyle m}
   stocks, denoted 
  
    
      
        ζ
      
    
    {\displaystyle \zeta }
  , and one consisting of the bottom 
  
    
      
        n
        −
        m
      
    
    {\displaystyle n-m}
   stocks, denoted 
  
    
      
        η
      
    
    {\displaystyle \eta }
  . More specifically,

  
    
      
        
          ζ
          
            i
          
        
        (
        t
        )
        =
        
          
            
              
                ∑
                
                  k
                  =
                  1
                
                
                  m
                
              
              
                μ
                
                  (
                  k
                  )
                
              
              (
              t
              )
              
                
                  1
                
                
                  {
                  
                    μ
                    
                      i
                    
                  
                  (
                  t
                  )
                  =
                  
                    μ
                    
                      (
                      k
                      )
                    
                  
                  (
                  t
                  )
                  }
                
              
            
            
              
                ∑
                
                  l
                  =
                  1
                
                
                  m
                
              
              
                μ
                
                  (
                  l
                  )
                
              
              (
              t
              )
            
          
        
        
        
           and 
        
        
          η
          
            i
          
        
        (
        t
        )
        =
        
          
            
              
                ∑
                
                  k
                  =
                  m
                  +
                  1
                
                
                  n
                
              
              
                μ
                
                  (
                  k
                  )
                
              
              (
              t
              )
              
                
                  1
                
                
                  {
                  
                    μ
                    
                      i
                    
                  
                  (
                  t
                  )
                  =
                  
                    μ
                    
                      (
                      k
                      )
                    
                  
                  (
                  t
                  )
                  }
                
              
            
            
              
                ∑
                
                  l
                  =
                  m
                  +
                  1
                
                
                  n
                
              
              
                μ
                
                  (
                  l
                  )
                
              
              (
              t
              )
            
          
        
      
    
    {\displaystyle \zeta _{i}(t)={\frac {\sum _{k=1}^{m}\mu _{(k)}(t)\mathbf {1} _{\{\mu _{i}(t)=\mu _{(k)}(t)\}}}{\sum _{l=1}^{m}\mu _{(l)}(t)}}\qquad {\text{ and }}\eta _{i}(t)={\frac {\sum _{k=m+1}^{n}\mu _{(k)}(t)\mathbf {1} _{\{\mu _{i}(t)=\mu _{(k)}(t)\}}}{\sum _{l=m+1}^{n}\mu _{(l)}(t)}}}
  for 
  
    
      
        1
        ≤
        i
        ≤
        n
        .
      
    
    {\displaystyle 1\leq i\leq n.}
   Fernholz (1999), (2002) showed that the relative performance of the large-stock portfolio with respect to the market is given as

  
    
      
        log
        ⁡
        
          (
          
            
              
                
                  Z
                  
                    ζ
                  
                
                (
                t
                )
              
              
                
                  Z
                  
                    μ
                  
                
                (
                t
                )
              
            
          
          )
        
        =
        log
        ⁡
        
          (
          
            
              
                
                  μ
                  
                    (
                    1
                    )
                  
                
                (
                T
                )
                +
                ⋯
                +
                
                  μ
                  
                    (
                    m
                    )
                  
                
                (
                T
                )
              
              
                
                  μ
                  
                    (
                    1
                    )
                  
                
                (
                0
                )
                +
                ⋯
                +
                
                  μ
                  
                    (
                    m
                    )
                  
                
                (
                0
                )
              
            
          
          )
        
        −
        
          
            1
            2
          
        
        
          ∫
          
            0
          
          
            T
          
        
        
          
            
              
                μ
                
                  (
                  m
                  )
                
              
              (
              t
              )
            
            
              
                μ
                
                  (
                  1
                  )
                
              
              (
              t
              )
              +
              ⋯
              +
              
                μ
                
                  (
                  m
                  )
                
              
              (
              t
              )
            
          
        
        
        d
        
          Λ
          
            (
            m
            ,
            m
            +
            1
            )
          
        
        (
        t
        )
        .
      
    
    {\displaystyle \log \left({\frac {Z_{\zeta }(t)}{Z_{\mu }(t)}}\right)=\log \left({\frac {\mu _{(1)}(T)+\cdots +\mu _{(m)}(T)}{\mu _{(1)}(0)+\cdots +\mu _{(m)}(0)}}\right)-{\frac {1}{2}}\int _{0}^{T}{\frac {\mu _{(m)}(t)}{\mu _{(1)}(t)+\cdots +\mu _{(m)}(t)}}\,d\Lambda ^{(m,m+1)}(t).}
  Indeed, if there is no turnover at the mth rank during the interval 
  
    
      
        [
        0
        ,
        T
        ]
      
    
    {\displaystyle [0,T]}
  , the fortunes of 
  
    
      
        ζ
      
    
    {\displaystyle \zeta }
   relative
to the market are determined solely on the basis of how the total capitalization of this sub-universe
of the 
  
    
      
        m
      
    
    {\displaystyle m}
   largest stocks fares, at time 
  
    
      
        T
      
    
    {\displaystyle T}
   versus time 0; whenever there is turnover at the 
  
    
      
        m
      
    
    {\displaystyle m}
  -th rank,
though, 
  
    
      
        ζ
      
    
    {\displaystyle \zeta }
   has to sell at a loss a stock that gets “relegated” to the lower league, and buy a stock
that has risen in value and been promoted. This accounts for the “leakage” that is evident in the
last term, an integral with respect to the cumulative turnover process 
  
    
      
        
          Λ
          
            (
            m
            ,
            m
            +
            1
            )
          
        
      
    
    {\displaystyle \Lambda ^{(m,m+1)}}
   of the relative weight in the large-cap portfolio 
  
    
      
        ζ
      
    
    {\displaystyle \zeta }
   of the stock that occupies the mth rank.
The reverse situation prevails with the portfolio 
  
    
      
        η
      
    
    {\displaystyle \eta }
   of small stocks, which gets to sell at a profit stocks that are being promoted to the “upper capitalization” league, and buy relatively cheaply stocks that are being relegated:

  
    
      
        log
        ⁡
        
          (
          
            
              
                
                  Z
                  
                    η
                  
                
                (
                t
                )
              
              
                
                  Z
                  
                    μ
                  
                
                (
                t
                )
              
            
          
          )
        
        =
        log
        ⁡
        
          (
          
            
              
                
                  μ
                  
                    (
                    m
                    +
                    1
                    )
                  
                
                (
                T
                )
                +
                ⋯
                +
                
                  μ
                  
                    (
                    n
                    )
                  
                
                (
                T
                )
              
              
                
                  μ
                  
                    (
                    m
                    +
                    1
                    )
                  
                
                (
                0
                )
                +
                ⋯
                +
                
                  μ
                  
                    (
                    n
                    )
                  
                
                (
                0
                )
              
            
          
          )
        
        +
        
          
            1
            2
          
        
        
          ∫
          
            0
          
          
            T
          
        
        
          
            
              
                μ
                
                  (
                  m
                  +
                  1
                  )
                
              
              (
              t
              )
            
            
              
                μ
                
                  (
                  m
                  +
                  1
                  )
                
              
              (
              t
              )
              +
              ⋯
              +
              
                μ
                
                  (
                  n
                  )
                
              
              (
              t
              )
            
          
        
        .
      
    
    {\displaystyle \log \left({\frac {Z_{\eta }(t)}{Z_{\mu }(t)}}\right)=\log \left({\frac {\mu _{(m+1)}(T)+\cdots +\mu _{(n)}(T)}{\mu _{(m+1)}(0)+\cdots +\mu _{(n)}(0)}}\right)+{\frac {1}{2}}\int _{0}^{T}{\frac {\mu _{(m+1)}(t)}{\mu _{(m+1)}(t)+\cdots +\mu _{(n)}(t)}}.}
  It is clear from these two expressions that, in a coherent and stochastically stable market, the small-
stock cap-weighted portfolio 
  
    
      
        ζ
      
    
    {\displaystyle \zeta }
   will tend to outperform its large-stock counterpart 
  
    
      
        η
      
    
    {\displaystyle \eta }
  , at least over
large time horizons and; in particular, we have under those conditions

  
    
      
        
          lim
          
            T
            →
            ∞
          
        
        
          
            1
            T
          
        
        log
        ⁡
        
          (
          
            
              
                
                  Z
                  
                    η
                  
                
                (
                t
                )
              
              
                
                  Z
                  
                    μ
                  
                
                (
                t
                )
              
            
          
          )
        
        =
        
          λ
          
            (
            m
            ,
            m
            +
            1
            )
          
        
        
          E
        
        
          (
          
            
              
                
                  M
                  
                    (
                    1
                    )
                  
                
                
                  
                    M
                    
                      (
                      1
                      )
                    
                  
                  +
                  ⋯
                  +
                  
                    M
                    
                      (
                      m
                      )
                    
                  
                
              
            
            +
            
              
                
                  M
                  
                    (
                    m
                    +
                    1
                    )
                  
                
                
                  
                    M
                    
                      (
                      m
                      +
                      1
                      )
                    
                  
                  +
                  ⋯
                  +
                  
                    M
                    
                      (
                      n
                      )
                    
                  
                
              
            
          
          )
        
        >
        0.
      
    
    {\displaystyle \lim _{T\rightarrow \infty }{\frac {1}{T}}\log \left({\frac {Z_{\eta }(t)}{Z_{\mu }(t)}}\right)=\lambda ^{(m,m+1)}\mathbb {E} \left({\frac {M_{(1)}}{M_{(1)}+\cdots +M_{(m)}}}+{\frac {M_{(m+1)}}{M_{(m+1)}+\cdots +M_{(n)}}}\right)>0.}
  This quantifies the so-called size effect. In Fernholz (1999, 2002), constructions such as these are generalized to include functionally generated portfolios based on ranked market weights.

First- and second-order models
First- and second-order models are hybrid Atlas models that reproduce some of the structure of real stock markets. First-order models have only rank-based parameters, and second-order models have both rank-based and name-based parameters.
Suppose that 
  
    
      
        
          X
          
            1
          
        
        ,
        …
        ,
        
          X
          
            n
          
        
      
    
    {\displaystyle X_{1},\ldots ,X_{n}}
   is a coherent market, and that the limits

  
    
      
        
          
            σ
          
          
            k
          
          
            2
          
        
        =
        
          lim
          
            t
            →
            ∞
          
        
        
          t
          
            −
            1
          
        
        ⟨
        log
        ⁡
        
          μ
          
            (
            k
            )
          
        
        ⟩
        (
        t
        )
      
    
    {\displaystyle \mathbf {\sigma } _{k}^{2}=\lim _{t\to \infty }t^{-1}\langle \log \mu _{(k)}\rangle (t)}
  and

  
    
      
        
          
            g
          
          
            k
          
        
        =
        
          lim
          
            T
            →
            ∞
          
        
        
          
            1
            T
          
        
        
          ∫
          
            0
          
          
            T
          
        
        
          ∑
          
            i
            =
            1
          
          
            n
          
        
        
          
            1
          
          
            {
            
              r
              
                t
              
            
            (
            i
            )
            =
            k
            }
          
        
        
        d
        log
        ⁡
        
          μ
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle \mathbf {g} _{k}=\lim _{T\to \infty }{\frac {1}{T}}\int _{0}^{T}\sum _{i=1}^{n}\mathbf {1} _{\{r_{t}(i)=k\}}\,d\log \mu _{i}(t)}
  exist for 
  
    
      
        k
        =
        1
        ,
        …
        ,
        n
      
    
    {\displaystyle k=1,\ldots ,n}
  , where 
  
    
      
        
          r
          
            t
          
        
        (
        i
        )
      
    
    {\displaystyle r_{t}(i)}
   is the rank of 
  
    
      
        
          X
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle X_{i}(t)}
  . Then the  Atlas model 
  
    
      
        
          
            
              
                X
                ^
              
            
          
          
            1
          
        
        ,
        …
        ,
        
          
            
              
                X
                ^
              
            
          
          
            n
          
        
      
    
    {\displaystyle {\widehat {X}}_{1},\ldots ,{\widehat {X}}_{n}}
   defined by

  
    
      
        d
        log
        ⁡
        
          
            
              
                X
                ^
              
            
          
          
            i
          
        
        (
        t
        )
        =
        
          ∑
          
            k
            =
            1
          
          
            n
          
        
        
          
            g
          
          
            k
          
        
        
        
          
            1
          
          
            {
            
              
                
                  
                    r
                    ^
                  
                
              
              
                t
              
            
            (
            i
            )
            =
            k
            }
          
        
        
        d
        t
        +
        
          ∑
          
            k
            =
            1
          
          
            n
          
        
        
          
            σ
          
          
            k
          
        
        
          
            1
          
          
            {
            
              
                
                  
                    r
                    ^
                  
                
              
              
                t
              
            
            (
            i
            )
            =
            k
            }
          
        
        
        d
        
          W
          
            i
          
        
        (
        t
        )
        ,
      
    
    {\displaystyle d\log {\widehat {X}}_{i}(t)=\sum _{k=1}^{n}\mathbf {g} _{k}\,\mathbf {1} _{\{{\hat {r}}_{t}(i)=k\}}\,dt+\sum _{k=1}^{n}\mathbf {\sigma } _{k}\mathbf {1} _{\{{\hat {r}}_{t}(i)=k\}}\,dW_{i}(t),}
  where 
  
    
      
        
          
            
              
                r
                ^
              
            
          
          
            t
          
        
        (
        i
        )
      
    
    {\displaystyle {\hat {r}}_{t}(i)}
   is the rank of 
  
    
      
        
          
            
              
                X
                ^
              
            
          
          
            i
          
        
        (
        t
        )
      
    
    {\displaystyle {\widehat {X}}_{i}(t)}
   and 
  
    
      
        (
        
          W
          
            1
          
        
        ,
        …
        ,
        
          W
          
            n
          
        
        )
      
    
    {\displaystyle (W_{1},\ldots ,W_{n})}
   is an 
  
    
      
        n
      
    
    {\displaystyle n}
  -dimensional Brownian motion process, is the first-order model for the original market, 
  
    
      
        
          X
          
            1
          
        
        ,
        …
        ,
        
          X
          
            n
          
        
      
    
    {\displaystyle X_{1},\ldots ,X_{n}}
  .
Under reasonable conditions, the capital distribution curve for a first-order model will be close to that of the original market. However, a first-order model is ergodic in the sense that each stock asymptotically spends   
  
    
      
        (
        1
        
          /
        
        n
        )
      
    
    {\displaystyle (1/n)}
  -th of its time at each rank, a property that is not present in actual markets. In order to vary the proportion of time that a stock spends at each rank, it is necessary to use some form of hybrid Atlas model with  parameters that depend on both rank and name. An effort in this direction was made by Fernholz, Ichiba, and Karatzas (2013), who introduced a second-order model for the market with rank- and name-based growth parameters, and variance parameters that depended  on rank alone.

References
Fernholz, E.R. (2002). Stochastic Portfolio Theory. New York: Springer-Verlag.